{% extends "base.html" %}
{% block content %}
  <div class="row g-4">
    <div class="col-12 col-lg-7">
      <div class="card shadow-sm">
        <div class="card-body">
          <h1 class="h4 mb-3">Find visually similar products</h1>
          <p class="text-muted">Upload an image or paste an image URL. We’ll search {{ product_count }} products by visual similarity.</p>

          {% if not db_ready %}
            <div class="alert alert-warning">
              Database not initialized. Run: <code>python scripts/build_index.py</code>
            </div>
          {% endif %}

          <form action="{{ url_for('search') }}" method="post" enctype="multipart/form-data" onsubmit="enableLoading()">
            <div class="mb-3">
              <label for="image_file" class="form-label">Upload image</label>
              <input class="form-control" type="file" id="image_file" name="image_file" accept="image/*">
            </div>
            <div class="text-center text-muted my-2">or</div>
            <div class="mb-3">
              <label for="image_url" class="form-label">Image URL</label>
              <input class="form-control" type="url" id="image_url" name="image_url" placeholder="https://example.com/image.jpg">
            </div>

            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label for="min_score" class="form-label">Minimum similarity</label>
                <input type="range" class="form-range" min="0" max="100" step="5" id="min_score" name="min_score" value="50" oninput="document.getElementById('minScoreVal').innerText=this.value">
                <div class="small text-muted">Show results with score ≥ <span id="minScoreVal">50</span></div>
              </div>
              <div class="col-12 col-md-6">
                <label for="max_results" class="form-label">Max results</label>
                <input type="number" class="form-control" id="max_results" name="max_results" min="5" max="60" value="24">
              </div>
            </div>

            <div class="d-grid d-md-flex gap-2 mt-4">
              <button class="btn btn-primary px-4" type="submit">Search</button>
              <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Reset</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-5">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h6 text-uppercase text-muted">How it works</h2>
          <ul class="mt-3">
            <li>We compute a perceptual hash (pHash) of your image</li>
            <li>Compare it with precomputed pHashes of our product images</li>
            <li>Return the most visually similar results with a similarity score</li>
          </ul>
          <div class="small text-muted">
            Tip: Use clear product images on plain backgrounds for best results.
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
